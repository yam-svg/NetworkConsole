# 响应拦截功能使用说明

## 🎯 功能概述

响应拦截功能允许您拦截、查看和修改网络请求的响应内容，这对于前端开发和调试非常有用。

## 🔧 功能特性

### ✨ 核心功能
- **响应拦截**: 拦截指定 URL 模式的网络响应
- **内容编辑**: 在弹出窗口中编辑响应内容
- **自动解压缩**: 支持 gzip/deflate 压缩内容的自动解压缩和重新压缩
- **实时注入**: 修改后的响应实时注入到页面中

### 🛡️ 安全特性
- **用户授权**: 启用前需要用户明确确认
- **URL 模式验证**: 防止恶意模式注入
- **响应大小限制**: 限制响应内容大小（最大 10MB）
- **并发限制**: 最多同时对 3 个标签页启用拦截

## 📖 使用步骤

### 1. 启用响应拦截
1. 打开 DevTools 并切换到 "网络控制台" 面板
2. 点击 "响应拦截" 标签
3. 配置要拦截的 URL 模式（支持通配符 `*`）
   - 例如：`*/api/*` 匹配所有包含 `/api/` 的请求
   - 例如：`https://example.com/*` 匹配特定域名的所有请求
4. 点击"启用拦截"按钮
5. 在安全确认对话框中点击"确定"

### 2. 拦截和修改响应
1. 启用拦截后，符合模式的请求完成时会自动弹出编辑窗口
2. 在编辑窗口中：
   - **响应内容**标签：编辑响应状态码和内容
   - **响应头**标签：查看原始响应头
   - **设置**标签：查看请求详情和内容信息
3. 修改完成后点击"应用修改"按钮
4. 修改后的响应会被注入到页面中

### 3. 禁用拦截
- 在响应拦截面板中点击"禁用拦截"按钮
- 或者关闭标签页会自动清理拦截状态

## 💡 使用示例

### 示例 1: 拦截 API 响应
```
URL 模式: */api/user/*
场景: 修改用户信息 API 的响应数据
```

### 示例 2: 拦截特定域名
```
URL 模式: https://jsonplaceholder.typicode.com/*
场景: 修改测试 API 的响应内容
```

### 示例 3: 拦截所有请求
```
URL 模式: *
场景: 调试所有网络请求（谨慎使用）
```

## ⚠️ 注意事项

### 安全警告
- **仅在开发环境使用**: 响应拦截功能具有强大的权限，仅应在受信任的开发环境中使用
- **避免敏感数据**: 不要在生产环境或包含敏感数据的页面中使用
- **恶意网站风险**: 恶意网站可能尝试利用此功能窃取数据

### 技术限制
- **CORS 限制**: 某些跨域请求可能无法被拦截
- **压缩支持**: 目前支持 gzip 和 deflate，Brotli 暂不支持
- **性能影响**: 启用拦截可能会影响页面性能
- **并发限制**: 最多同时拦截 3 个标签页

### 最佳实践
1. **精确模式**: 使用具体的 URL 模式而不是通配符 `*`
2. **及时禁用**: 调试完成后及时禁用拦截功能
3. **内容验证**: 修改响应前确保内容格式正确
4. **备份原始数据**: 修改前记录原始响应内容

## 🔍 故障排除

### 常见问题

**Q: 为什么某些请求没有被拦截？**
A: 检查 URL 模式是否正确，某些请求类型（如 preflight 请求）可能不会被拦截。

**Q: 修改后的响应没有生效？**
A: 确保页面的 JavaScript 代码能够处理修改后的响应，某些缓存机制可能影响效果。

**Q: 拦截功能启用失败？**
A: 检查是否有其他扩展程序冲突，或者标签页是否支持调试器权限。

**Q: 压缩内容无法正确处理？**
A: 目前仅支持 gzip/deflate，如果是 Brotli 压缩，会显示原始内容。

### 错误代码
- `安全检查失败`: URL 模式包含不安全字符
- `超过最大拦截数量限制`: 同时拦截的标签页过多
- `响应验证失败`: 修改后的响应格式不正确
- `调试器权限不足`: 无法获取必要的调试权限

## 📚 技术原理

响应拦截功能基于 Chrome DevTools Protocol 实现：

1. **debugger API**: 使用 `chrome.debugger` 附加到标签页
2. **Network.setRequestInterception**: 设置请求拦截模式
3. **Network.getResponseBody**: 获取响应内容
4. **Runtime.evaluate**: 注入修改后的响应到页面

## 🔄 版本历史

- **v1.0.0**: 初始版本，支持基本的响应拦截和修改
- 压缩内容处理
- 安全防护机制
- 用户界面优化

---

**⚠️ 重要提醒**: 此功能仅供开发和调试使用，请勿在生产环境或包含敏感信息的网站上使用。